(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{30:function(e,t,s){"use strict";(function(e){var a=s(6),i=s.n(a);t.a={components:{VueTagsInput:i()},data:()=>({search_machines:[],search_sites:[],search:{page:1,machine_id:"",site_id:""},popticket:{},categories:[],sub_categories:[],sites:[],selected_machine:"",users:[],machines:[],Tickets:{},editmode:!1,MaterialCost:null,ServiceCost:null,form:new Form({id:"",site_id:"",category_id:"",sub_category_id:"",free_service_no:"",ticket_type:"Periodic Maintenance",service_type:"Paid Service",machine_id:"",ticket_no:"",vendor_id:"",user_id:"",likely_date:"",estimated_material_cost:"",estimated_service_cost:"",maintenance_provider:"vendor",problem_description:"",complaint_nature:"Major"}),stages:[{id:"",stage_no:"",stage_date:"",description:"",file:"",new_file:""}],formclose:new Form({id:"",machine_status:"",edit_type:"closeticket",ticket_type:"Periodic Maintenance",actual_date:"",actual_material_cost:"",actual_service_cost:"",current_run_hour:"",current_km_run:"",current_production_fig:"",production_loss:"",production_loss_amount:"",status:"Closed",vendor_resolve_date:"",vendor_attain_date:"",vendor_response_date:"",vendor_call_date:""}),pop_machine:"",pop_ticket:"",opn_stage:["Vendor created","Vendor Assigned","Order issued","Payment under process","Payment Done","Logistics under process","Materials despatched","Material received at site","Maintainace under progress"],last_stage_index:0,last_stage_date:""}),methods:{getLabel:e=>"object"==typeof e?e.far_no+" - "+e.name:e,viewModal(t){this.pop_ticket=t,e("#viewmodal").modal("show")},AddStage(){this.stages.push({id:"",stage_no:"",stage_date:"",description:"",file:"",new_file:""})},async choose_stage_file(e,t){this.stages[t].new_file=e.target.files[0]},async uploadMaterialCost(e){this.MaterialCost=e.target.files},async uploadServiceCost(e){this.ServiceCost=e.target.files},getResults(e=1){this.$Progress.start(),this.search.page=e,axios.get("/api/ticket",{params:this.search}).then(({data:e})=>this.Tickets=e.data),this.$Progress.finish()},submitCloseTicket(){this.$validator.reset(),this.$validator.validateAll("closeticket").then(async t=>{if(t){let t=this.$loading.show({container:this.$refs.vps_submit_pop});this.formclose.put("/api/ticket/"+this.formclose.id).then(s=>{s.data.success&&(e("#closemodal").modal("hide"),this.$validator.reset(),this.formclose.reset(),Toast.fire({icon:"success",title:s.data.message}),this.upload_files(this.formclose.id,"actual"),this.loadTickets()),t.hide()}).catch(()=>{t.hide(),void 0!==err.response.data&&this.$setErrorsFromResponse(err.response.data)})}})},closeModal(t){e("#closemodal").modal("show"),this.$validator.reset(),this.formclose.reset(),this.$refs.fileactualservice.value=null,this.$refs.fileactualmaterial.value=null,this.pop_ticket=t,this.pop_machine=t.machine,this.formclose.fill(t),this.formclose.edit_type="closeticket"},editModal(t){this.editmode=!0,this.$validator.pause(),this.form.reset(),this.pop_ticket=t,this.$refs.fileservice.value=null,this.$refs.filematerial.value=null,this.MaterialCost=null,this.ServiceCost=null,e("#addNew").modal("show"),this.form.fill(t),this.stages=[],t.stages&&(this.stages=t.stages),this.$validator.resume()},newModal(){this.stages=[],this.AddStage(),this.editmode=!1,this.$validator.reset(),this.$validator.pause(),this.form.reset(),this.$refs.fileservice.value=null,this.$refs.filematerial.value=null,this.MaterialCost=null,this.ServiceCost=null,e("#addNew").modal("show"),this.$validator.resume()},loadTickets(){this.$gate.isAdmin()&&axios.get("/api/ticket",{params:this.search}).then(({data:e})=>this.Tickets=e.data)},async upload_files(e,t=!1){this.MaterialCost&&this.MaterialCost.forEach(s=>{var a=new FormData;a.append("file",s),t?a.append("file_type","Actual Estimated Material"):a.append("file_type","Estimated Material"),a.append("ticket_id",e),axios.post("api/ticket/files",a).then(e=>{console.log("gallery uploaded")})}),this.ServiceCost&&this.ServiceCost.forEach(s=>{var a=new FormData;a.append("file",s),t?a.append("file_type","Actual Estimated Service"):a.append("file_type","Estimated Service"),a.append("ticket_id",e),axios.post("api/ticket/files",a).then(e=>{console.log("gallery uploaded")})})},async upload_stages(e){this.stages&&this.stages.forEach(t=>{var s=new FormData;s.append("id",t.id),s.append("stage_no",t.stage_no),s.append("stage_date",t.stage_date),s.append("description",t.description),s.append("ticket_id",e),axios.post("api/ticket/stages",s).then(e=>{console.log("stages uploaded")})})},submitTicket(){this.$validator.validateAll().then(async t=>{if(t){let t=this.$loading.show({container:this.$refs.vps_submit_pop});this.form.id?this.form.put("/api/ticket/"+this.form.id).then(s=>{s.data.success&&(e("#addNew").modal("hide"),Toast.fire({icon:"success",title:s.data.message}),this.upload_stages(this.form.id),this.upload_files(this.form.id),this.loadTickets()),t.hide()}).catch(()=>{t.hide(),void 0!==err.response.data&&this.$setErrorsFromResponse(err.response.data)}):this.form.post("/api/ticket").then(s=>{s.data.success&&(e("#addNew").modal("hide"),Toast.fire({icon:"success",title:s.data.message}),this.upload_files(s.data.data.id),this.loadTickets()),t.hide()}).catch(()=>{t.hide(),void 0!==err.response.data&&this.$setErrorsFromResponse(err.response.data)})}})},async check_free_service(){this.selected_machine&&(this.selected_machine.completed_free_service>=this.selected_machine.free_service_no?(this.form.service_type="Paid Service",this.form.free_service_no=""):this.form.free_service_no=this.selected_machine.completed_free_service+1,this.selected_machine&&"New"==this.selected_machine.machine_type&&this.form.service_type)},async get_machine(){axios.get("/api/ticket_machine",{params:{site_id:this.form.site_id,category_id:this.form.category_id,sub_category_id:this.form.sub_category_id}}).then(e=>{this.machines=e.data.data}).catch(()=>console.warn("Oh. Something went wrong"))}},mounted(){},created(){this.loadTickets()},beforeCreate(){axios.get("api/get_pre_machine").then(e=>{this.categories=e.data.data.Category,this.sites=e.data.data.sites}),axios.get("/api/initial_ticket").then(e=>{this.users=e.data.data.vendors,this.machines=e.data.data.machines,this.search_machines=e.data.data.machines,this.search_sites=e.data.data.sites}).catch(()=>console.warn("Oh. Something went wrong"))},watch:{async"form.sub_category_id"(e,t){e&&this.get_machine()},async"form.site_id"(e,t){e&&this.get_machine()},"form.category_id":{handler:function(e,t){e&&(axios.get("api/category/"+e).then(e=>{this.sub_categories=e.data.data}),this.get_machine())},deep:!0,initial:!0},stages:{handler:function(e,t){if(e&&e.length>0){let t=e[e.length-1];t.stage_no&&(this.last_stage_index=this.opn_stage.indexOf(t.stage_no)),t.stage_date&&(this.last_stage_date=new Date(t.stage_date).toISOString())}else this.last_stage_index=0,this.pop_ticket&&this.pop_ticket.likely_date?this.last_stage_date=new Date(this.pop_ticket.likely_date).toISOString():this.last_stage_date=(new Date).toISOString()},deep:!0,initial:!0},async"form.maintenance_provider"(e){"vendor"!=e&&(this.form.service_type="Paid Service"),axios.get("api/user/list",{params:{type:e}}).then(e=>{this.users=e.data.data}).catch(()=>console.warn("Oh. Something went wrong"))},async"form.machine_id"(e){this.selected_machine=this.machines.find(t=>t.id===e),await this.check_free_service()},async"form.service_type"(e){"Free Service"==e&&await this.check_free_service()}}}}).call(this,s(3))},377:function(e,t,s){"use strict";s.r(t);var a=s(30),i=s(2),o=Object(i.a)(a.a,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("section",{staticClass:"content"},[s("div",{staticClass:"container-fluid"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-12"},[e.$gate.isAdmin()?s("div",{staticClass:"card"},[s("div",{staticClass:"card-header"},[s("h3",{staticClass:"card-title"},[e._v("Ticket Report")]),e._v(" "),s("div",{staticClass:"card-tools"},[s("button",{staticClass:"btn btn-sm btn-primary",attrs:{type:"button"},on:{click:e.newModal}},[s("i",{staticClass:"fa fa-plus-square"}),e._v("\n                                Export CSV\n                            ")])])]),e._v(" "),s("div",{staticClass:"card-body p-2"},[s("form",{attrs:{autocomplete:"off"},on:{submit:function(t){return t.preventDefault(),e.getResults()}}},[s("div",{staticClass:"form-row"},[s("div",{staticClass:"col"},[s("v-select",{attrs:{label:"name","get-option-label":e.getLabel,reduce:function(e){return e.id},options:e.search_machines,placeholder:"Enter machines ...",name:"machine_id"},model:{value:e.search.machine_id,callback:function(t){e.$set(e.search,"machine_id",t)},expression:"search.machine_id"}})],1),e._v(" "),s("div",{staticClass:"col"},[s("v-select",{attrs:{label:"site_name",reduce:function(e){return e.id},options:e.search_sites,placeholder:"Select Site...",name:"site_id"},model:{value:e.search.site_id,callback:function(t){e.$set(e.search,"site_id",t)},expression:"search.site_id"}})],1),e._v(" "),s("div",{staticClass:"col"},[s("v-select",{attrs:{label:"site_name",options:["Open","Closed"],placeholder:"Select Status...",name:"status"},model:{value:e.search.status,callback:function(t){e.$set(e.search,"status",t)},expression:"search.status"}})],1),e._v(" "),s("button",{staticClass:"btn btn-success",attrs:{type:"submit"}},[e._v("Search")])])])]),e._v(" "),s("div",{staticClass:"card-body table-responsive p-0"},[s("table",{staticClass:"table table-hover"},[e._m(0),e._v(" "),s("tbody",e._l(e.Tickets.data,(function(t){return s("tr",{key:t.id},[s("td",[e._v(e._s(t.ticket_no))]),e._v(" "),s("td",{staticClass:"text-capitalize"},[e._v(e._s(t.machine.name))]),e._v(" "),s("td",[e._v(e._s(t.machine.far_no))]),e._v(" "),s("td",[e._v(e._s(t.created_by_name))]),e._v(" "),s("td",[e._v(e._s(e._f("myDate")(t.created_at)))]),e._v(" "),s("td",[e._v(e._s(e._f("myDate")(t.likely_date)))]),e._v(" "),s("td",{domProps:{innerHTML:e._s(t.status)}})])})),0)])]),e._v(" "),s("div",{staticClass:"card-footer"},[s("pagination",{attrs:{data:e.Tickets},on:{"pagination-change-page":e.getResults}})],1)]):e._e()])]),e._v(" "),e.$gate.isAdmin()?e._e():s("div",[s("not-found")],1)])])}),[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("thead",[s("tr",[s("th",[e._v("Ticket No ")]),e._v(" "),s("th",[e._v("Machine Name")]),e._v(" "),s("th",[e._v("Machine Far No")]),e._v(" "),s("th",[e._v("Created By")]),e._v(" "),s("th",[e._v("Created Date")]),e._v(" "),s("th",[e._v("Expected date")]),e._v(" "),s("th",[e._v("Ticket Status")]),e._v(" "),s("th",[e._v("Action")])])])}],!1,null,null,null);t.default=o.exports}}]);
//# sourceMappingURL=9.bundle.ff2f940127095daa8a3e.js.map